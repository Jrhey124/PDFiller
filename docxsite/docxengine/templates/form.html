{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document Generator - T.I.P</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; 
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .animate-slide-down {
            animation: slideDown 0.3s ease-out;
        }
        
        .animate-fade-in {
            animation: fadeIn 0.4s ease-out;
        }
        
        select, input, textarea {
            transition: all 0.2s ease;
        }
        
        select:focus, input:focus, textarea:focus {
            transform: translateY(-1px);
        }
        
        button {
            transition: all 0.2s ease;
        }
        
        button:active {
            transform: scale(0.98);
        }
        
        .student-entry {
            animation: slideDown 0.3s ease-out;
        }
        
        #addressee-details {
            animation: slideDown 0.3s ease-out;
        }
        
        /* Custom Dropdown Styles */
        .custom-select {
            position: relative;
        }
        
        .custom-select-trigger {
            position: relative;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .custom-select-trigger:hover {
            transform: translateY(-1px);
        }
        
        .custom-select-options {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #d1d5db;
            border-top: none;
            border-radius: 0 0 0.375rem 0.375rem;
            max-height: 0;
            overflow: hidden;
            z-index: 10;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: max-height 0.3s ease, opacity 0.3s ease;
            opacity: 0;
        }
        
        .custom-select.open .custom-select-options {
            max-height: 250px;
            overflow-y: auto;
            opacity: 1;
            animation: slideDown 0.3s ease-out;
        }
        
        .custom-select.open .custom-select-trigger {
            border-radius: 0.375rem 0.375rem 0 0;
            border-bottom-color: #ffd60a;
        }
        
        .custom-option {
            padding: 0.625rem 0.75rem;
            cursor: pointer;
            transition: background-color 0.2s ease, color 0.2s ease, padding-left 0.2s ease;
        }
        
        .custom-option:hover {
            background-color: #ffd60a;
            color: #000;
            padding-left: 1rem;
        }
        
        .custom-option.selected {
            background-color: #fef3c7;
            font-weight: 500;
        }
        
        /* Button hover animations */
        .remove-btn {
            transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease;
        }
        
        .remove-btn:hover {
            background-color: #ffd60a !important;
            color: #000 !important;
            border-color: #ffd60a !important;
        }
        
        .add-student-btn {
            transition: color 0.2s ease;
        }
        
        .add-student-btn:hover {
            color: #ffd60a !important;
        }
        
        .submit-btn {
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        
        .submit-btn:hover {
            background-color: #ffd60a !important;
            color: #000 !important;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen py-12 px-4">
    
    <script src="{% static 'student_fields.js' %}"></script>
    <script id="addressee-data" type="application/json">
        {{ addressees_json|safe }}
    </script>
    
    <script>
        // Custom dropdown functionality
        document.addEventListener('DOMContentLoaded', function() {
            // First, populate addressee options
            const dataScript = document.getElementById('addressee-data');
            const addresseeOptionsContainer = document.getElementById('addressee-options');
            const addresseeDetails = document.getElementById('addressee-details');
            const addresseeHiddenInput = document.getElementById('addressee');
            const addresseeSelect = document.getElementById('addressee-select');

            if (dataScript && addresseeOptionsContainer) {
                const names = JSON.parse(dataScript.textContent);
                
                names.forEach(name => {
                    const option = document.createElement('div');
                    option.className = 'custom-option';
                    option.setAttribute('data-value', name);
                    option.textContent = name;
                    addresseeOptionsContainer.appendChild(option);
                });
            }

            // Then setup all dropdown handlers
            const customSelects = document.querySelectorAll('.custom-select');
            
            customSelects.forEach(select => {
                const trigger = select.querySelector('.custom-select-trigger');
                const options = select.querySelectorAll('.custom-option');
                const hiddenInput = select.parentElement.querySelector('input[type="hidden"]');
                
                if (!trigger) return;
                
                // Toggle dropdown
                trigger.addEventListener('click', function(e) {
                    e.stopPropagation();
                    // Close other dropdowns
                    customSelects.forEach(s => {
                        if (s !== select) s.classList.remove('open');
                    });
                    select.classList.toggle('open');
                });
                
                // Handle option selection
                const handleOptionClick = function(e) {
                    e.stopPropagation();
                    const value = this.getAttribute('data-value');
                    const text = this.textContent;
                    
                    // Update UI
                    const allOptions = select.querySelectorAll('.custom-option');
                    allOptions.forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    
                    const selectedValueSpan = trigger.querySelector('.selected-value');
                    if (selectedValueSpan) {
                        selectedValueSpan.textContent = text;
                        selectedValueSpan.classList.remove('text-gray-400');
                    }
                    
                    // Update hidden input
                    if (hiddenInput) {
                        hiddenInput.value = value;
                    }
                    
                    // Special handling for addressee dropdown
                    if (select.id === 'addressee-select' && addresseeDetails) {
                        addresseeDetails.textContent = value;
                        addresseeDetails.classList.remove('hidden');
                    }
                    
                    // Close dropdown
                    select.classList.remove('open');
                };
                
                // Attach handlers to existing options
                options.forEach(option => {
                    option.addEventListener('click', handleOptionClick);
                });
                
                // Use MutationObserver to handle dynamically added options (for addressee)
                if (select.id === 'addressee-select') {
                    const observer = new MutationObserver(function(mutations) {
                        mutations.forEach(function(mutation) {
                            mutation.addedNodes.forEach(function(node) {
                                if (node.nodeType === 1 && node.classList.contains('custom-option')) {
                                    node.addEventListener('click', handleOptionClick);
                                }
                            });
                        });
                    });
                    
                    const optionsContainer = select.querySelector('.custom-select-options');
                    if (optionsContainer) {
                        observer.observe(optionsContainer, { childList: true });
                    }
                }
            });
            
            // Close dropdowns when clicking outside
            document.addEventListener('click', function() {
                customSelects.forEach(select => {
                    select.classList.remove('open');
                });
            });
        });
    </script>

    <div class="max-w-2xl mx-auto animate-fade-in">
        <div class="mb-8">
            <h2 class="text-2xl font-semibold text-gray-900 mb-1">Document Generator</h2>
            <p class="text-gray-600">Technological Institute of the Philippines</p>
        </div>

        <div class="bg-white border-2 border-gray-200 rounded-lg shadow-md p-8">
            <form method="POST" class="space-y-6">
                {% csrf_token %}

                <div>
                    <label class="block text-sm font-medium text-gray-900 mb-1.5">
                        Template Type
                    </label>
                    <div class="custom-select">
                        <div class="custom-select-trigger w-full px-3 py-2.5 border-2 border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#ffd60a] focus:border-[#ffd60a] text-sm bg-white" tabindex="0">
                            <span class="selected-value">Request Letter</span>
                        </div>
                        <div class="custom-select-options">
                            <div class="custom-option selected" data-value="Request_Letter.docx">Request Letter</div>
                            <div class="custom-option" data-value="Endorsement.docx">Endorsement</div>
                            <div class="custom-option" data-value="Clearance.docx">Clearance</div>
                        </div>
                    </div>
                    <input type="hidden" name="template" id="template" value="Request_Letter.docx" required>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-900 mb-1.5">
                        Addressee
                    </label>
                    <div class="custom-select" id="addressee-select">
                        <div class="custom-select-trigger w-full px-3 py-2.5 border-2 border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#ffd60a] focus:border-[#ffd60a] text-sm bg-white" tabindex="0">
                            <span class="selected-value text-gray-400">Select addressee</span>
                        </div>
                        <div class="custom-select-options" id="addressee-options">
                            <!-- Options will be populated by JavaScript -->
                        </div>
                    </div>
                    <input type="hidden" name="addressee" id="addressee" required>
                    <div id="addressee-details" class="mt-2 p-3 bg-gray-100 border-l-4 border-[#ffd60a] rounded text-sm text-gray-800 hidden"></div>
                </div>

                <div>
                    <label for="adviser" class="block text-sm font-medium text-gray-900 mb-1.5">
                        Adviser Name
                    </label>
                    <input type="text" name="adviser" id="adviser" required 
                           class="w-full px-3 py-2.5 border-2 border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#ffd60a] focus:border-[#ffd60a] text-sm">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-900 mb-1.5">
                        Student Names
                    </label>
                    <div id="student-fields" class="space-y-2">
                        <div class="student-entry flex gap-2">
                            <input type="text" name="students" required 
                                   class="flex-1 px-3 py-2.5 border-2 border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#ffd60a] focus:border-[#ffd60a] text-sm">
                            <button type="button" onclick="removeStudentField(this)" 
                                    class="remove-btn px-3 py-2.5 border-2 border-gray-300 text-gray-700 rounded-md text-sm font-medium">
                                Remove
                            </button>
                        </div>
                    </div>
                    <button type="button" onclick="addStudentField()" 
                            class="add-student-btn mt-2 text-sm text-gray-700 font-medium underline">
                        + Add another student
                    </button>
                </div>

                <div>
                    <label for="course_section" class="block text-sm font-medium text-gray-900 mb-1.5">
                        Course & Section
                    </label>
                    <input type="text" name="course_section" id="course_section" required 
                           placeholder="e.g. BSCS 4A"
                           class="w-full px-3 py-2.5 border-2 border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#ffd60a] focus:border-[#ffd60a] text-sm">
                </div>

                <div>
                    <label for="details" class="block text-sm font-medium text-gray-900 mb-1.5">
                        Additional Details
                    </label>
                    <textarea name="details" id="details" required rows="4"
                              class="w-full px-3 py-2.5 border-2 border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#ffd60a] focus:border-[#ffd60a] text-sm"></textarea>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-900 mb-1.5">
                        Salutation
                    </label>
                    <div class="custom-select">
                        <div class="custom-select-trigger w-full px-3 py-2.5 border-2 border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#ffd60a] focus:border-[#ffd60a] text-sm bg-white" tabindex="0">
                            <span class="selected-value">Mr.</span>
                        </div>
                        <div class="custom-select-options">
                            <div class="custom-option selected" data-value="Mr.">Mr.</div>
                            <div class="custom-option" data-value="Ms.">Ms.</div>
                        </div>
                    </div>
                    <input type="hidden" name="gender" id="gender" value="Mr." required>
                </div>

                <div class="pt-2">
                    <button type="submit" 
                            class="submit-btn w-full py-3 bg-black text-[#ffd60a] rounded-md font-semibold focus:outline-none focus:ring-2 focus:ring-[#ffd60a] focus:ring-offset-2 text-sm">
                        Generate Document
                    </button>
                </div>
            </form>
        </div>
    </div>

</body>
</html>



